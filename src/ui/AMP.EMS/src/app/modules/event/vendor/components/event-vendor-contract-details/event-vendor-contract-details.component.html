<ng-container *ngIf="eventVendorContract$ | withStatus | async as eventVendorContract">
    <p-toolbar styleClass="mb-4">
        <ng-template pTemplate="left">
        </ng-template>
        <ng-template pTemplate="right">
            <div class="my-2">
                <button pButton pRipple label="Save" icon="pi pi-save" class="p-button-success mr-2"
                    (click)="save(eventVendorContract.value!)" [loading]="eventVendorContract.loading!"></button>
            </div>
        </ng-template>
    </p-toolbar>

    <div class="card">
        <div class="font-medium text-3xl text-900 mb-3">{{eventVendorContract.value?.vendor?.name}}</div>
        <div class="text-500 mb-5">{{eventVendorContract.value?.vendor?.description}}
            <p-skeleton *ngIf="eventVendorContract.loading"></p-skeleton>
        </div>
        <div class="text-500 mb-5">
            <span *ngIf="!eventVendorContract.loading">
                <i class="pi pi-warehouse"></i>
                {{eventVendorContract.value?.vendor?.address || '-'}}
            </span>
            <span *ngIf="!eventVendorContract.loading">
                <i class="pi pi-phone"></i>
                {{eventVendorContract.value?.vendor?.contactInformation}}
            </span>
            <p-skeleton *ngIf="eventVendorContract.loading"></p-skeleton>
        </div>
        <ul class="list-none p-0 m-0">
            <li class="flex align-items-center py-3 px-2 border-top-1 surface-border flex-wrap">
                <div class="text-500 w-6 md:w-2 font-medium">Amount</div>
                <div class="text-900 w-full md:w-8 md:flex-order-0 flex-order-1 line-height-3">
                    <p-inputNumber *ngIf="!eventVendorContract.loading" id="amount" currency="PHP" mode="currency"
                        locale="en-US" [(ngModel)]="eventVendorContract.value!.amount!" />
                    <p-skeleton *ngIf="eventVendorContract.loading"></p-skeleton>
                </div>
                <div class="w-6 md:w-2 flex justify-content-end">
                </div>
            </li>
            <li class="flex align-items-center py-3 px-2 border-top-1 surface-border flex-wrap"
                *ngIf="eventVendorContractStates$ | withStatus | async as eventVendorContractStates">
                <div class="text-500 w-6 md:w-2 font-medium">State</div>
                <div class="text-900 w-full md:w-8 md:flex-order-0 flex-order-1">
                    <p-dropdown *ngIf="!eventVendorContract.loading" [options]="eventVendorContractStates.value"
                        [loading]="eventVendorContractStates.loading"
                        [(ngModel)]="eventVendorContract.value!.eventVendorContractStateId" optionValue="id"
                        optionLabel="name" placeholder="Select a state"></p-dropdown>

                    <p-skeleton *ngIf="eventVendorContract.loading"></p-skeleton>
                </div>
                <div class="w-6 md:w-2 flex justify-content-end">
                </div>
            </li>
            <li class="flex align-items-center py-3 px-2 border-top-1 surface-border flex-wrap">
                <div class="text-500 w-6 md:w-2 font-medium align-items-start">Details</div>
                <div class="text-900 w-full md:w-8 md:flex-order-0 flex-order-1 line-height-3">
                    <textarea rows="20" cols="50" pInputTextarea *ngIf="!eventVendorContract.loading" id="description"
                        [(ngModel)]="eventVendorContract.value!.details"
                        [value]="eventVendorContract.value!.details"></textarea>

                    <p-skeleton *ngIf="eventVendorContract.loading"></p-skeleton>
                </div>
                <div class="w-6 md:w-2 flex justify-content-end">
                </div>
            </li>
        </ul>
    </div>
    <div class="card" *ngIf="eventVendorContract.value?.id && {
        eventVendorContractPaymentTypes: eventVendorContractPaymentTypes$ | withStatus | async,
        eventVendorContractPaymentStates: eventVendorContractPaymentStates$ | withStatus | async } as lookup">
        <div class="font-medium text-3xl text-500 mb-3">Payments</div>
        <p-table #dt *ngIf="eventVendorContractPayments$ | withStatus | async as eventVendorContractPayments"
            [value]="eventVendorContractPayments.value!" [rows]="10" [paginator]="true" editMode="row" [rowHover]="true"
            [loading]="eventVendorContractPayments.loading" [showLoader]="false" dataKey="id"
            [loading]="eventVendorContractPayments.loading" [showLoader]="false">
            <ng-template pTemplate="header">
                <tr>
                    <th>
                        <div class="flex justify-content-between align-items-center">
                            Type
                        </div>
                    </th>
                    <th>
                        <div class="flex justify-content-between align-items-center">
                            Due Amount
                        </div>
                    </th>
                    <th>
                        <div class="flex justify-content-between align-items-center">
                            Due Date
                        </div>
                    </th>
                    <th>
                        <div class="flex justify-content-between align-items-center">
                            State
                        </div>
                    </th>
                    <th>
                        Transaction Reference
                    </th>
                    <th></th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-item let-editing="editing">
                <tr [pEditableRow]="item">
                    <td>
                        <p-cellEditor>
                            <ng-template pTemplate="input">
                                <p-dropdown *ngIf="!lookup.eventVendorContractPaymentTypes!.loading" appendTo="body"
                                    [options]="lookup.eventVendorContractPaymentTypes!.value"
                                    [loading]="lookup.eventVendorContractPaymentTypes!.loading"
                                    [(ngModel)]="item.eventVendorContractPaymentTypeId" optionValue="id"
                                    optionLabel="name" placeholder="Select a state"></p-dropdown>
                            </ng-template>
                            <ng-template pTemplate="output">
                                <ng-container *ngIf="!lookup.eventVendorContractPaymentTypes!.loading">
                                    {{(lookup.eventVendorContractPaymentTypes!.value!| findItem :
                                    item.eventVendorContractPaymentTypeId : 'id')?.name
                                    || '-'}}
                                </ng-container>
                            </ng-template>
                        </p-cellEditor>
                    </td>
                    <td>
                        <p-cellEditor>
                            <ng-template pTemplate="input">
                                <p-inputNumber mode="currency" currency="PHP" [(ngModel)]="item.dueAmount" />
                            </ng-template>
                            <ng-template pTemplate="output">
                                {{item.dueAmount | currency : 'PHP'}}
                            </ng-template>
                        </p-cellEditor>
                    </td>
                    <td>
                        <p-cellEditor>
                            <ng-template pTemplate="input">
                                <p-calendar [(ngModel)]="item.dueDate" appendTo="body" />
                            </ng-template>
                            <ng-template pTemplate="output">
                                {{item.dueDate | date : 'shortDate'}}
                            </ng-template>
                        </p-cellEditor>
                    </td>
                    <td>
                        <p-cellEditor>
                            <ng-template pTemplate="input">
                                <p-dropdown *ngIf="!lookup.eventVendorContractPaymentStates!.loading" appendTo="body"
                                    [options]="lookup.eventVendorContractPaymentStates!.value"
                                    [loading]="lookup.eventVendorContractPaymentStates!.loading"
                                    [(ngModel)]="item.eventVendorContractPaymentStateId" optionValue="id"
                                    optionLabel="name" placeholder="Select a state"></p-dropdown>
                            </ng-template>
                            <ng-template pTemplate="output">
                                <ng-container *ngIf="!lookup.eventVendorContractPaymentStates!.loading">
                                    {{(lookup.eventVendorContractPaymentStates!.value | findItem :
                                    item.eventVendorContractPaymentStateId : 'id')?.name
                                    || '-'}}
                                </ng-container>
                            </ng-template>
                        </p-cellEditor>
                    </td>
                    <td>
                        <div class="flex align-items-center">
                            <button *ngIf="item.id && !item.transactionId" pButton pRipple type="button"
                                class="w-full p-button-info mr-2" pTooltip="Add a transaction"
                                (click)="openTransaction(item)" label="Add"></button>
                            <button *ngIf="item.transaction" pButton pRipple type="button"
                                (click)="openTransaction(item)" class="w-full p-button-text p-button-success mr-2"
                                pTooltip="Click to edit transaction"
                                label="{{item.transaction.transactionType.name}}"></button>
                        </div>
                    </td>
                    <td>
                        <div class="flex">
                            <button *ngIf="editing && !item.id" pButton pRipple type="button" pInitEditableRow
                                icon="pi pi-plus" class="p-button-text p-button-success mr-2" pTooltip="Add"
                                (click)="savePayment(item)">
                            </button>
                            <button *ngIf="!editing && item.id && item.id" pButton pRipple type="button"
                                pInitEditableRow icon="pi pi-pencil" class="p-button-text p-button-success mr-2"
                                pTooltip="Edit">
                            </button>
                            <button *ngIf="!editing && item.id" pButton pRipple class="p-button-text p-button-warning"
                                icon="pi pi-trash" (click)="delete(item)" pTooltip="Delete"></button>

                            <button *ngIf="editing && item.id" pButton pRipple type="button" pSaveEditableRow
                                icon="pi pi-save" (click)="savePayment(item)"
                                class="p-button-text p-button-text p-button-success mr-2" pTooltip="Save">
                            </button>
                            <button *ngIf="editing && item.id" pButton pRipple type="button" pCancelEditableRow
                                icon="pi pi-times" class="p-button-text p-button-text p-button-danger"
                                pTooltip="Cancel"></button>
                        </div>
                    </td>
                </tr>
            </ng-template>

            <ng-template pTemplate="emptymessage" let-columns>
                <tr>
                    <td [colSpan]="7">
                        No records found
                    </td>
                </tr>
            </ng-template>

            <ng-template pTemplate="loadingbody">
                <tr *ngFor="let i of [].constructor(5)">
                    <td><p-skeleton></p-skeleton></td>
                    <td><p-skeleton></p-skeleton></td>
                    <td><p-skeleton></p-skeleton></td>
                    <td><p-skeleton></p-skeleton></td>
                    <td><p-skeleton></p-skeleton></td>
                </tr>
            </ng-template>
        </p-table>
    </div>
</ng-container>

<p-dialog *ngIf="eventVendorContractPaymentTransaction$ | withStatus| async as eventVendorContractPaymentTransaction"
    [(visible)]="showTransactionDialog" [style]="{width: '450px'}" header="Transaction Details" [modal]="true"
    class="p-fluid">

    <ng-template pTemplate="content">
        <div class="field">
            <label for="amount">Amount</label>
            <p-inputNumber id="amount" currency="PHP" mode="currency"
                [(ngModel)]="eventVendorContractPaymentTransaction.value!.transaction!.amount" [disabled]="true" />
        </div>
        <div class="field">
            <label for="date">Reference Number</label>
            <input pInputText [(ngModel)]="eventVendorContractPaymentTransaction.value!.transaction!.referenceNumber" />
        </div>
        <div class="field">
            <label for="date">Date</label>
            <p-calendar [(ngModel)]="eventVendorContractPaymentTransaction.value!.transaction!.transactionDate"
                appendTo="body" />
        </div>
        <div class="field">
            <label for="type">Type</label>
            <p-dropdown *ngIf="transactionTypes$ | withStatus | async as transactionTypes"
                [(ngModel)]="eventVendorContractPaymentTransaction.value!.transaction!.transactionTypeId"
                inputId="inventoryStatus" optionValue="label" [options]="transactionTypes.value" optionLabel="name"
                optionValue="id" placeholder="Select">

            </p-dropdown>
        </div>
        <div class="field">
            <label for="description">Description</label>
            <textarea id="description" pInputTextarea
                [(ngModel)]="eventVendorContractPaymentTransaction.value!.transaction!.description" rows="3"
                cols="20"></textarea>
        </div>
    </ng-template>

    <ng-template pTemplate="footer">
        <button pButton pRipple label="Cancel" icon="pi pi-times" class="p-button-text"
            [loading]="eventVendorContractPaymentTransaction.loading!" (click)="closeTransactionDialog()"></button>
        <button pButton pRipple label="Save" icon="pi pi-check" class="p-button-text"
            [loading]="eventVendorContractPaymentTransaction.loading!"
            (click)="saveTransaction(eventVendorContractPaymentTransaction.value!)"></button>
    </ng-template>
</p-dialog>